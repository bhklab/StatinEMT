max.y <- max(foo$density)
A2 <- density(data[cells_2],adjust=2)
max.y <- max(A$y)
lines(A2$x,scales::rescale(A2$y, to=c(0,max.y)), col="mediumorchid4",lwd=4)
#abline(v=cutoff_tmp, col=c("red"), lty=2)
names(cutoffs) <- newSet
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rnaseq",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
cutoffs
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
pdf("./Fig_5C_RNA.pdf",height = 18,width = 6)
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
dev.off()
hist(RNAseq_CTRPv2_newSet[,"label"])
div.off()
div.off()
dev.off()
dev.off()
hist(RNAseq_CTRPv2_newSet[,"label"])
boxplot(RNAseq_CTRPv2_newSet[,"label"])
boxplot(RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"])
boxplot(RNAseq_CTRPv2_newSet[,"ENSG00000039068_at"])
boxplot(RNAseq_CTRPv2_newSet[,"ENSG00000148516_at"])
boxplot(RNAseq_CTRPv2_newSet[,"ENSG00000115414_at"])
boxplot(RNAseq_CTRPv2_newSet[,"ENSG00000170558_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000170558_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"])
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
pdf("./Fig_5C_RNA.pdf",height = 18,width = 6)
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
RNAseq_CTRPv2_newSet[,"label"] <- RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"]
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
dev.off()
hist(RNAseq_CTRPv2_newSet[,"ENSG00000039068_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000148516_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000115414_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000170558_at"])
rowSums(RNAseq_CTRPv2_newSet)
rowSums(RNAseq_CTRPv2_newSet)==0
sum(rowSums(RNAseq_CTRPv2_newSet)==0)
newSet
sum(rowSums(RNAseq_CTRPv2_newSet[c(1,3,4,5)])==0)
sum(rowSums(RNAseq_CTRPv2_newSet[,c(1,3,4,5)])==0)
RNAseq_CTRPv2_newSet[rowSums(RNAseq_CTRPv2_newSet[,c(1,3,4,5)])==0,2]
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
pdf("./Fig_5C_RNA.pdf",height = 18,width = 6)
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
RNAseq_CTRPv2_newSet[,"label"] <- RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"]
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
dev.off()
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
pdf("./Fig_5C_RNA.pdf",height = 18,width = 6)
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
#RNAseq_CTRPv2_newSet[,"label"] <- RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"]
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
dev.off()
sum(rowSums(RNAseq_CTRPv2_newSet[,c(1,3,4,5)])==0)
RNAseq_CTRPv2_newSet[rowSums(RNAseq_CTRPv2_newSet[,c(1,3,4,5)])==0,2]
RNAseq_CTRPv2_newSet[rowSums(RNAseq_CTRPv2_newSet[,c(1,3,4,5)])==0,"label"]
sum(RNAseq_CTRPv2_newSet[,"label"]==1)
sum(RNAseq_CTRPv2_newSet[,"label"]==0)
hist(RNAseq_CTRPv2_newSet[,"ENSG00000039068_at"])
par(mfrow=c(3,2))
cutoffs <- NULL
for(i in 1:length(newSet)){
data <- RNAseq_CTRPv2_All_CCLE[,newSet[i]][!is.na(RNAseq_CTRPv2_All_CCLE[,newSet[i]])]
if(var(data)==0){
cutoffs <- c(cutoffs,max(data,na.rm = T))
next
}
rr2 <- mclust::Mclust(data = data, modelNames="V", G=2)
if(is.null(rr2[[1]])) { ## EM algorithm did not converge
message("didn't converage")
cutoffs <- c(cutoffs,max(data,na.rm = T))
next
}
cells_1 <- names(rr2$classification)[rr2$classification==1]
cells_2 <- names(rr2$classification)[rr2$classification==2]
cutoff_tmp <- mean(c(mean(data[cells_2]), mean(data[cells_1])))
cutoffs <- c(cutoffs,cutoff_tmp)
symbol <- names(expandedSet_Full)[expandedSet_Full==newSet[i]]
A1 <- density(data[cells_1],adjust=2)
max.y_tmp <- max(A1$y)
A <- density(data)
max.y <- max(A$y)
par(lwd = 4)
foo <- hist(data,breaks = 40,freq = F,axes = F, ylab = NULL, xlab = NULL,col = "lightgray", main = NULL,cex=2, xaxt='n',ann=FALSE)
max.y <- max(foo$density)
#  axis(side = 2, lwd = 4,ann=FALSE)
title(main = symbol,col.main="blue",cex.main=4)
max.y <- max(foo$density)
A1 <- density(data[cells_1],adjust=2)
lines(A1$x,scales::rescale(A1$y, to=c(0,max.y)),col="indianred4",lwd=4)
A2 <- density(data[cells_2],adjust=2)
max.y <- max(A$y)
lines(A2$x,scales::rescale(A2$y, to=c(0,max.y)), col="mediumorchid4",lwd=4)
abline(v=cutoff_tmp, col=c("red"), lty=2)
}
data <- RNAseq_CTRPv2_All_CCLE[,control[1]][!is.na(RNAseq_CTRPv2_All_CCLE[,control[1]])]
rr2 <- mclust::Mclust(data = data, modelNames="V", G=2)
if(is.null(rr2[[1]])) { ## EM algorithm did not converge
message("didn't work")
cutoffs <- c(cutoffs,max(data,na.rm = T))
next
}
cells_1 <- names(rr2$classification)[rr2$classification==1]
cells_2 <- names(rr2$classification)[rr2$classification==2]
#foo <- hist((data[cells_1]),ylab = NULL, xlab = NULL)
#plot(foo$mids, foo$counts, type="l")
#lines (density(data[cells_2]))
cutoff_tmp <- mean(c(mean(data[cells_2]), mean(data[cells_1])))
symbol <- "POLR2A"
A <- density(data)
max.y <- max(A$y)
par(lwd = 4)
foo <- hist(data,breaks = 40,freq = F,axes = F, ylab = NULL, xlab = NULL,col = "lightgray", main = NULL,cex=4,ylim = c(0,max.y+0.1))
#axis(side = 2, lwd = 4,ann=T)
title(main = symbol,col.main="blue",cex.main=4)
max.y <- max(foo$density)
A2 <- density(data[cells_2],adjust=2)
max.y <- max(A$y)
lines(A2$x,scales::rescale(A2$y, to=c(0,max.y)), col="mediumorchid4",lwd=4)
#abline(v=cutoff_tmp, col=c("red"), lty=2)
names(cutoffs) <- newSet
newSet_Dir <- expandedSet_Full_Direction[newSet]
CIs <- list()
pvalues <- list()
pdf("./Fig_5C_RNA.pdf",height = 18,width = 6)
par(mfrow=c(3,1))
for(drug in statins){
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
#RNAseq_CTRPv2_newSet[,"label"] <- RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"]
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
}
dev.off()
hist(RNAseq_CTRPv2_newSet[,"ENSG00000039068_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"])
hist(RNAseq_CTRPv2_newSet[,"ENSG00000148516_at"dev.off])
dev.off()
dev.off()
drug = statins[3]
cellsToKeep <- rownames(CTRPv2.CCLE@cell)[CTRPv2.CCLE@cell$tissueid!="haematopoietic_and_lymphoid_tissue"]
cellsToKeep <- intersect(cellsToKeep, unique(CTRPv2.CCLE@sensitivity$info$cellid[CTRPv2.CCLE@sensitivity$info$drugid==drug]) )
CTRPv2_test_subset <- subsetTo(CTRPv2.CCLE, drugs = drug,cells = cellsToKeep)
RNAseq_CTRPv2_Drug <- t(exprs(summarizeMolecularProfiles(CTRPv2_test_subset,mDataType = "rna",fill.missing = F)))
RNAseq_CTRPv2_newSet <- RNAseq_CTRPv2_Drug[,newSet]
for( gene in newSet){
RNAseq_CTRPv2_newSet[,gene] <- ifelse(RNAseq_CTRPv2_newSet[,gene]>cutoffs[gene],1,0)
}
label <- NULL
label <- apply(RNAseq_CTRPv2_newSet,MARGIN = 1,FUN = function(x){
if ( any(as.numeric(!xor(x , expandedSet_Full_Direction[newSet]))==1,na.rm = T)){
return(1)
}else{
return(0)
}
})
RNAseq_CTRPv2_newSet <- cbind(RNAseq_CTRPv2_newSet, "label"=label)
#RNAseq_CTRPv2_newSet[,"label"] <- RNAseq_CTRPv2_newSet[,"ENSG00000026025_at"]
AUC_subset <- summarizeSensitivityProfiles(CTRPv2_test_subset,sensitivity.measure = "auc_recomputed",fill.missing = F)*100
cellLines_intersect <- intersect(rownames(RNAseq_CTRPv2_newSet),names(AUC_subset))
expressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==1]
expressedCellLines <- intersect(cellLines_intersect,expressedCellLines)
notExpressedCellLines <- rownames(RNAseq_CTRPv2_newSet)[RNAseq_CTRPv2_newSet[,"label"]==0]
notExpressedCellLines <- intersect(cellLines_intersect,notExpressedCellLines)
par(font.axis = 2,font.lab=2,cex=1.5, lwd=4)
boxplot(cbind("Not Enriched"=AUC_subset[notExpressedCellLines],"Enriched"=AUC_subset[expressedCellLines]),ylab="AUC [%]",col=c("indianred2","lightskyblue"))
integrCindex <- Hmisc::rcorr.cens(S=AUC_subset[c(notExpressedCellLines,expressedCellLines)], x = as.numeric(RNAseq_CTRPv2_newSet[c(notExpressedCellLines,expressedCellLines),"label"]),outx = T )
se <- integrCindex['S.D.']/2
C <- integrCindex["C Index"]
low <- C-1.96*se; hi <- C+1.96*se
CI_info <- c(C,low,hi)
CIs[["EMT_Core"]][[drug]] <- C
names(CI_info) <- c("CI","CI 0.95 Low","CI 0.95 Hi")
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
pvalues[["EMT_Core"]][[drug]] <- Pvalue
title(main = drug)
par(font=2,cex=1.3)
legend("topleft",legend = c(paste("CI:", sprintf("%.2g",C)),paste("P-value:", sprintf("%.1E",Pvalue)),paste("n:",length(notExpressedCellLines)),paste("n:",length(expressedCellLines)) ),cex = 1,bty="n",pch = c(NA,NA,15,15),col=c("indianred2","lightskyblue") )
Pvalue
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
Pvalue
Pvalue <- NaN
Pvalue <-kruskal.test(list(AUC_subset[notExpressedCellLines], AUC_subset[expressedCellLines]))$p.value
Pvalue
gsub(drugNames(CTRPv2), pattern="N-{3-Chloro-4-[(3-fluorobenzyl)oxy]phenyl}-6-[5-({[2-(methylsulfonyl)ethyl]amino}methyl)-2-furyl]-4-quinazolinamine", replacement="lapatinib", fixed=TRUE)
drugNames(CTRPv2)
grep("Chloro",drugNames(CTRPv2))
drugNames(CTRPv2)[grep("Chloro",drugNames(CTRPv2))]
drugNames(CTRPv2)[grep("lapatinib",drugNames(CTRPv2))]
load("./data/CTRPv2.RData")
drugNames(CTRPv2)[grep("lapatinib",drugNames(CTRPv2))]
